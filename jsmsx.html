<html>
<head>
<title>jsMSX - The first MSX emulator 100% written in Javascript</title>
<style>
body {font-size:small; line-height:140%; padding:2px;}
table {font-size:small; line-height:140%; padding:2px;}
a:hover {background:yellow;}
h1 {color:red;}
big {color:red;}
</style>
<script src="source/msx.js" type="text/javascript"></script>
<script src="source/z80.js" type="text/javascript"></script>
<script src="source/psg8910.js" type="text/javascript"></script>
<script src="source/tms9918.js" type="text/javascript"></script>
<!--[if IE]><script type="text/javascript" src="excanvas.js"></script><![endif]-->
<script src="source/browserio.js" type="text/javascript"></script>
<script src="source/ui.js" type="text/javascript"></script>
<script src="express/msx1.rom.js" type="text/javascript"></script>
<script src="express/goonies.rom.js" type="text/javascript"></script>
</head>
<body onload="msx_init();">
  <div style="width:1000px;margin:2em auto 0 auto;">
    <table>
      <tr>
        <td valign="top" style="width:260px">
          <br>
          <div style="width:160px;"></div>
          <div style="width:160px;"></div>
          <div style="width:160px;"></div>
        </td>
        <td valign="top" style="width:580px;">
          <div id="middlecolumn" style="width:580px;">
            <h1>jsMSX Online Demo</h1>
            <h2>The first MSX emulator 100% written in Javascript.</h2>
            <h3>Currently at <a href="http://sourceforge.net/project/showfiles.php?group_id=175343">version 0.9.2</a></h3>
            <p>
              <a href="#about">About</a> |
              <a href="#requirements">Requirements</a> |
              <a href="#emulator">The Online Demo</a> |
              <br>
              <a href="#demo"><big><b>Express Demo (just hit the button [start])</b></big></a>
            </p>
            <a name="introduction"></a>
            <p style="background-color:rgb(223, 223, 160);">
              This page allows you to do an <a href="#emulator">online test</a> of <a href="http://sourceforge.net/projects/jsmsx">jsMSX</a>. 
              If you would like to download or contribute to it, please have a look at the page of <a href="http://sourceforge.net/projects/jsmsx">the project</a>.
            </p>
            <a name="demo"></a>
            <p>
              jsMSX Copyright (c) 2006 Marcus Granado [mrc.gran(@)gmail.com] 
            </p>
            <div>
              jsMSX 0.9.2 on [canvas]:<br>
              <canvas id="canvas" name="canvas" width="256" height="192" style="border:medium solid;"></canvas>
              <br>
              <input id="start" value="start" onclick="msx_start();" type="button">
              <input id="stop" value="pause" disabled="true" onclick="msx_stop();" type="button">
              <input id="reset" value="reset" onclick="msx_reset();" type="button">
              Interrupts:
              <input id="interrupts" value="0" size="5" type="text">
              <input id="scale2x" value="scale 2x" onclick="msx_doublescreen();" type="button">
              <br>
              Just wait, it may be slow in your browser...
              <br>
              Actual speed should be around 60 interrupts/sec.
              <br>
            </div>
            <a name="about"></a>
            <br>
            <p>
              <big><b>jsMSX</b></big> 
              is a <a href="http://en.wikipedia.org/wiki/MSX">MSX</a> emulator 100% written in <a href="http://en.wikipedia.org/wiki/Javascript">Javascript</a>. Yes, you read it: Javascript! 
              It emulates the underlying <a href="http://en.wikipedia.org/wiki/Z80">Z80 CPU</a>, <a href="http://en.wikipedia.org/wiki/TMS9918">TMS9918 Video Display Processor (VDP)</a>, PPI, RAM slots and Megaram. In its present form, it should be able to run any program or game developed for MSX 1.0.
            </p>
            <p>
              If you think you'd like to participate, are just curious or want to say hello, <a href="http://sourceforge.net/projects/jsmsx">please have a look at the project</a>.
            </p>
            <p>
              Portions of the initial javascript code was derived from
              Arnon Cardoso's Java MSX Emulator (first Java MSX emulator), 
              Murilo Queiroz's Java Phoenix Emulator (first Java Arcade emulator) and
              Davidson&amp;Pollard's Z80 class of the Spectrum Java Emulator,
              after reading this thread: http://www.msx.org/forumtopic4176.html.
              Thank you all for your past efforts!
            </p>
            <a name="requirements"></a>
            <h2 style="background-color:rgb(223, 223, 160);">Requirements:</h2>
            <p>
              jsMSX requires a web browser that is able to execute Javascript 1.3 and that implements the tag <a href="http://whatwg.org/specs/web-apps/current-work/#scs-dynamic">[canvas]</a>, for instance <a href="http://www.mozilla.org">Firefox 1.5</a> or 2.0+, <a href="http://www.opera.com">Opera 9.0</a>, <a href="http://www.apple.com/support/downloads/safari.html">Safari</a> and <a href="http://excanvas.sourceforge.net/">maybe even IE 6.0 with the Canvas Hack Plug-in (excanvas)</a> (this hack is very very slow here, and since IE 6.0 and 7.0 do not implement [canvas] natively, you'd better switch for instance to Firefox or wait for IE 8.0 :). 
            </p>
            <p>
              If the methods <a href="http://whatwg.org/specs/web-apps/current-work/#pixel">getImageData()</a> and <a href="http://whatwg.org/specs/web-apps/current-work/#pixel">putImageData()</a> are available, for instance in <a href="http://developer.mozilla.org">Firefox 2.0</a>, an automatic mode for displaying graphics faster is used. 
              <b>Therefore, currently FF 2.0 is the recommended platform to run jsMSX on.</b>
            </p>
            <p> 
              This online demo is only fully supported on FF 1.5 (unaccelerated gfx fallback mode) and FF 2.0 (accelerated gfx mode), even though <a href="http://svn.sourceforge.net/jsmsx/tags">the core jsMSX files</a> should work on any browser with the tag [canvas] (see Express Demo below). 
              This support limitation of the online demo is due to differences in I/O mechanisms between web browsers for fetching ROM files only, and it is not intrinsic to jsMSX browser support itself, which is only dependent on the availability of the [canvas] tag. 
              In a future version of this demo, I/O support for Opera and Safari will be added. 
              It currently supports fetching ROM files on FF using the prefixes 'http://' and 'file://'.
              If you know of any other web browsers on which the jsMSX demo works, or you would like to add I/O support for your favorite web browser, <a href="http://sourceforge.net/forum/?group_id=175343">please drop a line to the project forum</a>.
            </p>
            <a name="emulator"></a>
            <h2 style="background-color:rgb(223, 223, 160);">The Online Demo:</h2>
            <h3><i>Express Demo:</i></h3>
            <p>
              <a href="#demo">Just press [start] in the demo above</a> and the default demo bios and cartridge roms will be already loaded in the correct MSX virtual slots. The express demo should work on any web browser with [canvas] tag (such as Firefox 1.5/2.0+, Opera 9.0, Safari and IE 6.0/7.0+excanvas).
            </p>
            <h3><i>or, to load arbitrary roms:</i></h3>
            <p>
              <b>First of all, SAVE this page (File|Save menu) to your local hard disk and execute it from there (File|Open File menu) in Firefox.
                Without doing this the javascript code will not be allowed to fetch the ROM files from the public servers! Also, be sure to use Firefox 1.5/2.0+ (see above).
              </b>
            </p>
            <p>Please load the ROM images before starting the emulator:
              (To load the BASIC, load only the BIOS ROM before hitting [start])
            </p>
            <p>
              <i>You will be asked to allow javascript to fetch the file. Just answer Allow/Yes.</i>
              <br>
              1. <input id="loadbiosrom" value="Load BIOS ROM" onclick="msx_loadbiosrom();" type="button">
              <input id="urlbiosrom" size="100" value="http://download.unesp.br/msx/funet/emulator/system_roms/openMSX/Gradiente/expert_1.0_basic-bios1.rom" type="text">
              <br>
              Other BIOS ROMs:<a href="http://www.msxarchive.nl/pub/msx/emulator/system_roms/openMSX/">http://www.msxarchive.nl/pub/msx/emulator/system_roms/openMSX/</a>
              <br>
              You can use file:///home/user/x.rom or file://c:/path/x.rom too to load local ROM files.
              <br>
              2. <input id="loadcartrom" value="Load Cartridge ROM" onclick="msx_loadcartrom();" type="button">
              <input id="urlcartrom" size="100" value="http://www.classicgaming.com/jmsxemu/goonies.rom" type="text">
              <br>
              Try also slaydock.rom, knightmare.rom, nemesis.rom, zaxxon.rom, payload.rom, etc.
              <br>
              You can use file:///home/user/x.rom or file://c:/path/x.rom too to load local ROM files.
              <br>
              Other game/appl ROMs:<a href="http://www.msxarchive.nl/pub/msx/games/roms/msx1/">http://www.msxarchive.nl/pub/msx/games/roms/msx1/</a>
            </p>
            <p></p>
            <table style="background:rgb(238, 238, 208) none repeat scroll 0% 50%; -moz-background-clip:-moz-initial; -moz-background-origin:-moz-initial; -moz-background-inline-policy:-moz-initial;" width="100%">
              <tbody>
                <tr>
                  <td>
                    <p>Loaded MSX ROM images:</p>
                  </td>
                </tr>
                <tr>
                  <td valign="top"><canvas id="canvasbiosrom" width="256" height="128"></canvas></td>
                  <td valign="top"><canvas id="canvascartrom" width="256" height="128"></canvas></td>
                </tr>
              </tbody>
            </table>
            <div id="3"></div>
            <div>
              <pre style="border:medium solid;"><p id="logbuf">Console:</p></pre>
            </div>
            <div></div>
            <div id="0"></div>
          </div>
        </td>
        <td valign="top" style="width:160px;">
          <br><br>
          <div style="width:160px;"></div>
          <div style="width:160px;"></div>
          <div style="width:160px;"></div>
        </td>
      </tr>
    </table>
  </div>
<script type="text/javascript">
var msx;

function msx_init() {
  var mylogbuf = document.getElementById('logbuf');
  var mycanvas = document.getElementById('canvas');
  var mycanvasctx = mycanvas.getContext('2d');

  msx = new JSMSX(window, mycanvasctx, mylogbuf);

  //initializes msx with some bios roms
  //just for demonstration purposes on webbrowsers
  //in which file i/o is not supported yet for this demo.
  //loads slot 0 with cbios 0.21 rom file [cbios.sourceforge.net]
  //for (var i=0; i<32768; i++) msx.m0[i]=cbios_main_msx1_rom[i];
  for (var i = 0; i < 32768; i++) msx.m0[i] = msx1_rom[i];
  for (var i = 16384; i < 49152; i++) msx.m2[i] = goonies_rom[i - 16384];

  //msx_start();
}

function msx_doublescreen() {
  var mycanvas = document.getElementById('canvas');
  var mycanvasctx = mycanvas.getContext('2d');

  //in case of not using direct canvas access
  //(accel gfx), let's play with scaling
  if (!mycanvasctx.getImageData) {
    mycanvas.width = 512;
    mycanvas.height = 384;
    mycanvasctx.scale(2.0, 2.0); //makes screen twice as big
    mycanvasctx.fillRect(0, 0, 256, 192);
  }
  document.getElementById('scale2x').disabled = true;
}

function msx_start() {
  //msx.interrupt_start();
  window.onkeydown = msx.handleEvent;
  window.onkeyup = msx.handleEvent;
  msx.execute_start();
  document.getElementById('start').disabled = true;
  document.getElementById('stop').disabled = false;
  document.getElementById('scale2x').disabled = true;
}

function msx_stop() {
  //msx.interrupt_stop();
  window.onkeydown = null;
  window.onkeyup = null;
  msx.execute_stop();
  document.getElementById('start').disabled = false;
  document.getElementById('stop').disabled = true;
}

function msx_reset() {
  msx.reset();
  msx.interruptCounter = 0;
}

function msx_showpc() {
  msx.showpc = true;
}

function msx_loadbiosrom() {
  msx.loadbiosrom(document.getElementById('urlbiosrom').value, 0, document.getElementById('canvasbiosrom'));
}

function msx_loadcartrom() {
  msx.loadcartrom(document.getElementById('urlcartrom').value, 2, 2, document.getElementById('canvascartrom'));
}
</script>
</body>
</html>
